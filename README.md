# Blender Vertex Export and Circle Fitting Workflow

This project provides a two-part solution for working with 2D circle geometry in Blender:

1.  **Blender Add-on: Export Selected Vertices:** A Blender add-on that exports the world-space coordinates of selected vertices from a mesh object to a `.xyz` file.
2.  **Standalone Python Tool: Batch Circle Fitter:** A standalone Python application (separate from Blender) that takes the `.xyz` vertex data, performs intelligent clustering and circle fitting, and exports the fitted circles to a `.dxf` file.

This workflow allows you to easily extract 2D vertex data from Blender, perform robust circle fitting externally, and then import the results back into Blender (or use them in other CAD software). This is particularly useful for scenarios like:

*   **Reverse Engineering:** Creating precise 2D CAD models from scanned mesh data.
*   **Architectural Modeling:** Fitting circles to point clouds representing circular features in floor plans or elevations.
*   **Technical Drawing Creation:** Extracting circular geometry from 3D models to generate 2D drawings.
*   **Data Analysis & Custom Pipelines:**  Processing vertex data with advanced algorithms and external tools (like the provided Python circle fitter).

**This combination enables round trip between the tools**

## Part 1: Blender Add-on - Export Selected Vertices

This Blender add-on provides a simple, focused way to export the world-space (x, y, z) coordinates of selected vertices to a `.xyz` file.

### Key Features (Blender Add-on):

*   **Selective Export:** Only exports selected vertices in Edit Mode (supports selection history).
*   **World-Space Coordinates:** Outputs vertex positions in Blender's world coordinate system, accounting for object transformations.
*   **`.xyz` Output:** Saves to a simple, text-based `.xyz` format (one vertex per line, space-separated coordinates).
*   **Convenient File Saving:** Option to automatically save to `vertex_output.xyz` in the same directory as your `.blend` file (if saved) for fast iteration.
*   **Blender UI Integration:** Adds a panel in the 3D View sidebar ("My Tools" tab) for easy access.
* **Error Management**: Provides warnings on the panel in the events of certain input error.
*   **Undo Support:** Integrated undo to roll back.

### Installation (Blender Add-on):

1.  **Download:** Download the `export_selected_vertices.py` file.
2.  **Blender Preferences:**  Open Blender, go to `Edit > Preferences > Add-ons`.
3.  **Install:** Click `Install...`, navigate to the `export_selected_vertices.py` file, and select it.
4.  **Enable:** Check the box next to the "Export Selected Vertices" add-on.

### Usage (Blender Add-on):

1.  **Select:**  Select a mesh object in Object Mode.
2.  **Edit Mode:** Enter Edit Mode (Tab).
3.  **Select Vertices:** Select the desired vertices.
4.  **Sidebar (N):** Open the 3D View sidebar (press `N` if it's hidden).
5.  **Export:** Go to the "My Tools" tab. Optionally, enable "Use Blend File Directory" for automatic file naming.  Click "Export Vertices."
6. If prompted select output location.

## Part 2: Standalone Python Tool - Batch Circle Fitter

**Crucially, this is *NOT* a Blender plugin.**  It's a separate, standalone Python application that processes the `.xyz` output from the Blender add-on.

### Key Features (Python Tool):

*   **Standalone:** Runs outside of Blender, leveraging your system's full Python environment.
*   **2D-Focused:** Optimized for *two-dimensional* data (X and Y coordinates only; Z is ignored).
*   **Noise-Robust Fitting:**  Employs an RANSAC method, refined, providing robustness to noisy data and outliers.
*   **Intelligent Clustering:**  Uses *HDBSCAN* to automatically identify separate circular segments (recommended minimum cluster size: 11).
*   **`.dxf` Export:**  Exports fitted circles to a `.dxf` file (using *ezdxf*), compatible with Blender and most CAD software.
*   **User-Friendly GUI:** Provides a simple *wxPython* graphical interface.
*   **Data Validation:** Includes data schema validation using *pandera*.
*   **Developed** under a *Windows 11 Miniconda environment*.

### How It Works (Python Tool):

1.  **Input:** Loads the `.xyz` file generated by the Blender add-on.
2.  **Clustering:** *HDBSCAN* groups the vertices into clusters representing potential circles. A *silhouette score* measures clustering quality.
3.  **Fitting:** The refined algorithm fits a circle to each cluster, determining the center (Xc, Yc) and radius (r).
4.  **Output:** Saves the fitted circles to a `.dxf` file.

### Silhouette Score Explained:

Ranges from -1 to +1, measuring clustering effectiveness:

*   **+1:** Ideal clustering (points are tightly grouped within their cluster, and well separated from other cluster)
*   **0:** Overlapping clusters
*   **-1:**  Points likely misassigned
* **>0.7:** consider strong clustering.
* **>0.5:** consider good clustering
* **>0.25:** is weak clustering.

Higher scores are generally better (above 0.5 is reasonable; above 0.7 indicates strong clustering).

### Installation and Usage (Python Tool):

1.  **Clone Repository:**

    ```bash
    git clone <your_repository_url>
    cd <your_repository_directory>
    ```

2.  **Create and Activate a Virtual Environment (Recommended):**

    ```bash
    python -m venv .venv
    source .venv/bin/activate  # On Linux/macOS
    .venv\Scripts\activate  # On Windows
    ```

3.  **Install Dependencies:**
     With included  `pyproject.toml`.

    ```bash
    pip install .
    ```

4.  **Run (From Command Line - *Not* Inside Blender):**

    ```bash
     python -m batch-circle-fitter
    ```
    Or,
        ```bash
     batch-circle-fitter
    ```

    The GUI will launch.

### GUI Guide (Python Tool):

*   **Vertex File (.xyz):** "Browse" to select the `.xyz` file from the Blender add-on.
*   **Output File (.dxf):** "Browse" to choose where to save the `.dxf` file.
*   **Minimum Cluster Size:** Sets the minimum points for a cluster (default: 11, generally a good starting point).
*   **Minimum/Maximum Radius:** Define the acceptable radius range for the fitted circles.
*   **Run Process:** Starts the fitting process.
*   **Exit:** Closes the application.
* **Project file:** This uses the pyproject.toml, no requirement.txt is to be found here!

### Project Structure and Code

This project consists of:
  - `batch_circle_fitter.py`: Containing the external program and all its functions.
 -  `export_selected_vertices.py`: The blender pluging, that exports the 3d vertex coordinates in `.xyz` files.
 -  `pyproject.toml`: Manging all external modules needed by  `batch_circle_fitter.py`.

Code highlight found from previous steps would be similar.
The blender plugin is quite self-explanatory.
Feel free to ask.

## Combined Workflow: Blender to Python and Back

1.  **In Blender:**
    *   Use the "Export Selected Vertices" add-on to save the coordinates of selected vertices to a `.xyz` file.
2.  **Standalone Python Tool:**
    *   Launch the `batch-circle-fitter` application from your system's command line.
    *   Load the `.xyz` file.
    *   Adjust settings (min cluster size, radius range) as needed.
    *   Run the process to fit circles and generate a `.dxf` file.
3.  **Back in Blender (or other CAD software):**
    *   Import the `.dxf` file containing the fitted circles.

This workflow allows you to seamlessly move between Blender's 3D modeling environment and the specialized 2D circle fitting capabilities of the standalone Python tool.

## Contributing:

We welcome contributions, suggestions and request! Report issues or submit pull requests on GitHub.

## License
This project uses the MIT license.
